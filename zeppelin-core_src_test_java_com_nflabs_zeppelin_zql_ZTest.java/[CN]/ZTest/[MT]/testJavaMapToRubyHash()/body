{
  ScriptEngineFactory factory=new JRubyScriptEngineFactory();
  ScriptEngine engine1=factory.getScriptEngine();
  SimpleBindings bindings=new SimpleBindings();
  engine1.setBindings(bindings,ScriptContext.ENGINE_SCOPE);
  Map<String,Object> params=new HashMap<String,Object>();
  params.put("s","hello");
  params.put("i",123);
  bindings.put("params",params);
  engine1.eval("require 'erb'\n" + "def convert map, hsh\n" + " map.each{|key,value|hsh[key]=value}\n"+ "end\n"+ "params= {}\n"+ "convert($params, params)\n"+ "$e = ERB.new(\"<%= params['s'] %> world\").result(binding)\n",bindings);
  assertEquals("hello world",(String)engine1.getBindings(ScriptContext.ENGINE_SCOPE).get("e"));
}
