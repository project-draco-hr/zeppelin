{
  WebDriver driver=getWebDriver();
  try {
    WebElement start=driver.findElement(By.partialLinkText("Start"));
    start.click();
    (new WebDriverWait(driver,10)).until(new ExpectedCondition<Boolean>(){
      public Boolean apply(      WebDriver d){
        return d.findElement(By.linkText("New")).isDisplayed();
      }
    }
);
    driver.findElement(By.linkText("New")).click();
    (new WebDriverWait(driver,10)).until(new ExpectedCondition<Boolean>(){
      public Boolean apply(      WebDriver d){
        return d.findElement(By.linkText("Run")).isDisplayed();
      }
    }
);
    driver.findElement(By.xpath("//div[@id='zqlEditor']//textarea")).sendKeys("@driver set exec;");
    driver.findElement(By.xpath("//div[@id='zqlEditor']//textarea")).sendKeys("\necho 'hello world';");
    driver.findElement(By.xpath("//div[@id='zqlEditor']//textarea")).sendKeys(Keys.chord(Keys.COMMAND,Keys.ENTER));
    driver.findElement(By.xpath("//div[@id='zqlEditor']//textarea")).sendKeys(Keys.chord(Keys.CONTROL,Keys.ENTER));
    driver.findElement(By.linkText("Run")).click();
    (new WebDriverWait(driver,10)).until(new ExpectedCondition<Boolean>(){
      public Boolean apply(      WebDriver d){
        return d.findElement(By.xpath("//div//a[text()='Running ...']")).isDisplayed();
      }
    }
);
    (new WebDriverWait(driver,60)).until(new ExpectedCondition<Boolean>(){
      public Boolean apply(      WebDriver d){
        return d.findElement(By.xpath("//div//a[text()='Run']")).isDisplayed();
      }
    }
);
    WebElement msg=driver.findElement(By.id("msgBox"));
    if (msg != null) {
      System.out.println("msgBox=" + msg.getText());
    }
    (new WebDriverWait(driver,20)).until(new ExpectedCondition<Boolean>(){
      public Boolean apply(      WebDriver d){
        return d.findElement(By.xpath("//div[@id='visualizationContainer']//iframe")).isDisplayed();
      }
    }
);
    WebDriver iframe=driver.switchTo().frame(driver.findElement(By.xpath("//div[@id='visualizationContainer']//iframe")));
    (new WebDriverWait(iframe,20)).until(new ExpectedCondition<Boolean>(){
      public Boolean apply(      WebDriver d){
        return d.findElement(By.xpath("//table//td[text()='hello world']")).isDisplayed();
      }
    }
);
  }
 catch (  WebDriverException e) {
    File scrFile=((TakesScreenshot)driver).getScreenshotAs(OutputType.FILE);
    System.out.println("Screenshot in: " + scrFile.getAbsolutePath());
    throw e;
  }
 finally {
    driver.quit();
  }
}
