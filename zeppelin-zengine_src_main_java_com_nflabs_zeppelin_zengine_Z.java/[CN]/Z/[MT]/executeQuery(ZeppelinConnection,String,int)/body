{
  initialize();
  if (query == null)   return null;
  if (query.startsWith("!")) {
    String cmd=query.substring(1);
    try {
      return shellCommand(cmd);
    }
 catch (    ExecuteException e) {
      logger().error("Failed to execute shell command " + cmd,e);
    }
catch (    IOException e) {
      logger().error("Failed to execute shell command " + cmd,e);
    }
catch (    ResultDataException e) {
      logger().error("Failed to execute shell command " + cmd,e);
    }
  }
  ZeppelinConnection con=null;
  try {
    con=connection(connection);
    logger().debug("connection=" + con);
    List<URI> resources=getResources();
    for (    URI res : resources) {
      con.addResource(res);
    }
    logger().info("executeQuery : " + query);
    return con.query(query);
  }
 catch (  Throwable e) {
    try {
      if (con != null) {
        con.close();
      }
    }
 catch (    Throwable e1) {
      logger().error("error on closing connection",e1);
    }
    throw new ZException(e);
  }
}
