{
  if (!wasRunning) {
    LOG.info("Staring test Zeppelin up...");
    executor=Executors.newSingleThreadExecutor();
    executor.submit(server);
    long s=System.currentTimeMillis();
    boolean started=false;
    while (System.currentTimeMillis() - s < 1000 * 60 * 3) {
      Thread.sleep(2000);
      started=checkIfServerIsRunning();
      if (started == true) {
        break;
      }
    }
    if (started == false) {
      throw new RuntimeException("Can not start Zeppelin server");
    }
    LOG.info("Test Zeppelin stared.");
    if ("true".equals(System.getenv("CI"))) {
      InterpreterSetting sparkIntpSetting=null;
      for (      InterpreterSetting intpSetting : ZeppelinServer.notebook.getInterpreterFactory().get()) {
        if (intpSetting.getGroup().equals("spark")) {
          sparkIntpSetting=intpSetting;
        }
      }
      sparkIntpSetting.getProperties().setProperty("master","spark://" + getHostname() + ":7071");
      sparkIntpSetting.getProperties().setProperty("spark.home",getSparkHome());
      pySpark=true;
      ZeppelinServer.notebook.getInterpreterFactory().restart(sparkIntpSetting.id());
    }
 else {
      InterpreterSetting sparkIntpSetting=null;
      for (      InterpreterSetting intpSetting : ZeppelinServer.notebook.getInterpreterFactory().get()) {
        if (intpSetting.getGroup().equals("spark")) {
          sparkIntpSetting=intpSetting;
        }
      }
      String sparkHome=getSparkHome();
      if (sparkHome != null) {
        sparkIntpSetting.getProperties().setProperty("spark.home",sparkHome);
        pySpark=true;
      }
      ZeppelinServer.notebook.getInterpreterFactory().restart(sparkIntpSetting.id());
    }
  }
}
