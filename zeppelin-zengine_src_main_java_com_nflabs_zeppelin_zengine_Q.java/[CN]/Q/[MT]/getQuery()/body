{
  String q=null;
  if (prev() != null && prev().name() != null) {
    String prevName=prev().name();
    q=query.replaceAll("[$][{]" + PREV_VAR_NAME + "[}]",prevName.trim());
  }
 else {
    q=query;
  }
  String tableCreation=null;
  if (name == null) {
    tableCreation="";
  }
 else {
    if (cache) {
      tableCreation="CREATE TABLE " + name + " AS ";
    }
 else {
      tableCreation="CREATE VIEW " + name + " AS ";
    }
  }
  return tableCreation + q;
}
