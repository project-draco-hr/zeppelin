{
  if (v == null) {
    if (defaultValue != null) {
      return defaultValue;
    }
 else {
      throw new ParamSpecException("Value can not be null");
    }
  }
 else {
    if (defaultValue != null) {
      if (defaultValue.equals(v)) {
        return v;
      }
    }
    if (options != null) {
      for (      Option<T> o : options) {
        if (o.getValue().equals(v)) {
          return v;
        }
      }
    }
    if (range != null) {
      Option<T> from=range.from();
      Option<T> to=range.to();
      if ((from == null || compare(from.getValue(),v) >= 0) && (to == null || compare(v,to.getValue()) >= 0)) {
        return v;
      }
 else {
        throw new ParamSpecException("Value not in range");
      }
    }
 else {
      if (allowAny == true) {
        return v;
      }
 else {
        throw new ParamSpecException("Does not allow any value");
      }
    }
  }
}
