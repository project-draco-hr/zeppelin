{
  ZQLJob sess=sm.create();
  sm.setZql(sess.getId(),"show tables");
  sm=new ZQLJobManager(schedulerFactory.createOrGetFIFOScheduler("analyze"),Z.fs(),Z.getConf().getString(ConfVars.ZEPPELIN_JOB_DIR));
  sm.run(sess.getId());
  while (sm.get(sess.getId()).getStatus() != Status.FINISHED) {
    Thread.sleep(300);
  }
  assertEquals(Status.FINISHED,sm.get(sess.getId()).getStatus());
  assertEquals(sess.getId(),sm.getHistory(sess.getId(),sm.listHistory(sess.getId()).firstKey()).getId());
  sm.run(sess.getId());
  while (sm.get(sess.getId()).getStatus() != Status.FINISHED) {
    Thread.sleep(300);
  }
  assertEquals(2,sm.listHistory(sess.getId()).size());
  sm.deleteHistory(sess.getId(),sm.listHistory(sess.getId()).firstKey());
  assertEquals(1,sm.listHistory(sess.getId()).size());
  sm.deleteHistory(sess.getId());
  assertEquals(0,sm.listHistory(sess.getId()).size());
}
