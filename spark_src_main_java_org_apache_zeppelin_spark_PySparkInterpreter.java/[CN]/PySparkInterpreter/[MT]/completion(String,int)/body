{
  if (buf.length() < cursor) {
    cursor=buf.length();
  }
  String completionString=getCompletionTargetString(buf,cursor);
  String completionCommand="completion.getCompletion('" + completionString + "')";
  SparkInterpreter sparkInterpreter=getSparkInterpreter();
  if (sparkInterpreter.getSparkVersion().isUnsupportedVersion() == false && pythonscriptRunning == false) {
    return new LinkedList<String>();
  }
  pythonInterpretRequest=new PythonInterpretRequest(completionCommand,"");
  statementOutput=null;
synchronized (statementSetNotifier) {
    statementSetNotifier.notify();
  }
synchronized (statementFinishedNotifier) {
    while (statementOutput == null) {
      try {
        statementFinishedNotifier.wait(1000);
      }
 catch (      InterruptedException e) {
        logger.info("wait drop");
        return new LinkedList<String>();
      }
    }
  }
  if (statementError) {
    return new LinkedList<String>();
  }
  InterpreterResult completionResult=new InterpreterResult(Code.SUCCESS,statementOutput);
  Gson gson=new Gson();
  return gson.fromJson(completionResult.message(),LinkedList.class);
}
