{
  InterpreterGroup interpreterGroup=interpreterSetting.getInterpreterGroup();
  String groupName=interpreterSetting.getGroup();
  InterpreterOption option=interpreterSetting.getOption();
  Properties properties=interpreterSetting.getProperties();
synchronized (interpreterGroup) {
    long interpreterRemovalWaitStart=System.nanoTime();
    long minTimeout=10 * 1000 * 1000000;
    long interpreterRemovalWaitTimeout=Math.max(minTimeout,conf.getInt(ConfVars.ZEPPELIN_INTERPRETER_CONNECT_TIMEOUT) * 2);
    while (interpreterGroup.containsKey(noteId)) {
      if (System.nanoTime() - interpreterRemovalWaitStart > interpreterRemovalWaitTimeout) {
        throw new InterpreterException("Can not create interpreter");
      }
      try {
        interpreterGroup.wait(1000);
      }
 catch (      InterruptedException e) {
        logger.debug(e.getMessage(),e);
      }
    }
  }
  logger.info("Create interpreter instance {} for note {}",interpreterSetting.getName(),noteId);
  for (  String className : interpreterClassList) {
    Set<String> keys=Interpreter.registeredInterpreters.keySet();
    for (    String intName : keys) {
      RegisteredInterpreter info=Interpreter.registeredInterpreters.get(intName);
      if (info.getClassName().equals(className) && info.getGroup().equals(groupName)) {
        Interpreter intp;
        if (option.isRemote()) {
          intp=createRemoteRepl(info.getPath(),noteId,info.getClassName(),properties,interpreterGroup.id);
        }
 else {
          intp=createRepl(info.getPath(),info.getClassName(),properties);
        }
synchronized (interpreterGroup) {
          List<Interpreter> interpreters=interpreterGroup.get(noteId);
          if (interpreters == null) {
            interpreters=new LinkedList<Interpreter>();
            interpreterGroup.put(noteId,interpreters);
          }
          interpreters.add(intp);
        }
        logger.info("Interpreter " + intp.getClassName() + " "+ intp.hashCode()+ " created");
        intp.setInterpreterGroup(interpreterGroup);
        break;
      }
    }
  }
}
