{
  String interpreterJson=conf.getInterpreterJson();
  ClassLoader cl=Thread.currentThread().getContextClassLoader();
  Path interpretersDir=Paths.get(conf.getInterpreterDir());
  if (Files.exists(interpretersDir)) {
    for (    Path interpreterDir : Files.newDirectoryStream(interpretersDir,new DirectoryStream.Filter<Path>(){
      @Override public boolean accept(      Path entry) throws IOException {
        return Files.exists(entry) && Files.isDirectory(entry);
      }
    }
)) {
      String interpreterDirString=interpreterDir.toString();
      registerInterpreterFromPath(interpreterDirString,interpreterJson);
      registerInterpreterFromResource(cl,interpreterDirString,interpreterJson);
      URLClassLoader ccl=new URLClassLoader(recursiveBuildLibList(interpreterDir.toFile()),cl);
      for (      String className : interpreterClassList) {
        try {
          Class.forName(className,true,ccl);
          Set<String> interpreterKeys=Interpreter.registeredInterpreters.keySet();
          for (          String interpreterKey : interpreterKeys) {
            if (className.equals(Interpreter.registeredInterpreters.get(interpreterKey).getClassName())) {
              Interpreter.registeredInterpreters.get(interpreterKey).setPath(interpreterDirString);
              logger.info("Interpreter " + interpreterKey + " found. class="+ className);
              cleanCl.put(interpreterDirString,ccl);
            }
          }
        }
 catch (        ClassNotFoundException e) {
        }
      }
    }
  }
  for (  RegisteredInterpreter registeredInterpreter : Interpreter.registeredInterpreters.values()) {
    logger.debug("Registered: {} -> {}. Properties: {}",registeredInterpreter.getInterpreterKey(),registeredInterpreter.getClassName(),registeredInterpreter.getProperties());
  }
  loadFromFile();
synchronized (interpreterSettings) {
    if (interpreterSettings.size() == 0) {
      HashMap<String,List<RegisteredInterpreter>> groupClassNameMap=new HashMap<>();
      for (      String k : Interpreter.registeredInterpreters.keySet()) {
        RegisteredInterpreter info=Interpreter.registeredInterpreters.get(k);
        String group=info.getGroup();
        if (!groupClassNameMap.containsKey(group)) {
          groupClassNameMap.put(group,new LinkedList<RegisteredInterpreter>());
          groupClassNameMap.get(group).add(info);
        }
 else {
          if (info.isDefaultInterpreter()) {
            groupClassNameMap.get(group).add(0,info);
          }
 else {
            groupClassNameMap.get(group).add(info);
          }
        }
      }
      for (      String groupName : interpreterGroupOrderList) {
        List<RegisteredInterpreter> infos=groupClassNameMap.remove(groupName);
        if (null != infos) {
          Properties p=new Properties();
          for (          RegisteredInterpreter info : infos) {
            Map<String,InterpreterProperty> interpreterProperties=info.getProperties();
            if (null != interpreterProperties) {
              for (              String key : info.getProperties().keySet()) {
                p.put(key,info.getProperties().get(key).getValue());
              }
            }
          }
          add(groupName,groupName,new LinkedList<Dependency>(),defaultOption,p);
        }
      }
      for (      String groupName : groupClassNameMap.keySet()) {
        List<RegisteredInterpreter> infos=groupClassNameMap.get(groupName);
        Properties p=new Properties();
        for (        RegisteredInterpreter info : infos) {
          Map<String,InterpreterProperty> interpreterProperties=info.getProperties();
          if (null != interpreterProperties) {
            for (            String key : info.getProperties().keySet()) {
              p.put(key,info.getProperties().get(key).getValue());
            }
          }
        }
        add(groupName,groupName,new LinkedList<Dependency>(),defaultOption,p);
      }
    }
  }
  for (  String settingId : interpreterSettings.keySet()) {
    InterpreterSetting setting=interpreterSettings.get(settingId);
    logger.info("Interpreter setting group {} : id={}, name={}",setting.getGroup(),settingId,setting.getName());
  }
}
