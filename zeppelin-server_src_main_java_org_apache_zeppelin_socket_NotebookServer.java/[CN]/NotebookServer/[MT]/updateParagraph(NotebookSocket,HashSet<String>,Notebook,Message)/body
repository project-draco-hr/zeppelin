{
  String paragraphId=(String)fromMessage.get("id");
  if (paragraphId == null) {
    return;
  }
  Map<String,Object> params=(Map<String,Object>)fromMessage.get("params");
  Map<String,Object> config=(Map<String,Object>)fromMessage.get("config");
  final Note note=notebook.getNote(getOpenNoteId(conn));
  if (!note.isWriter(userAndRoles)) {
    permissionError(conn,"write",userAndRoles,note.getWriters());
    return;
  }
  Paragraph p=note.getParagraph(paragraphId);
  p.settings.setParams(params);
  p.setConfig(config);
  p.setTitle((String)fromMessage.get("title"));
  p.setText((String)fromMessage.get("paragraph"));
  note.persist();
  broadcast(note.id(),new Message(OP.PARAGRAPH).put("paragraph",p));
}
