{
  String uri=request.getRequestURI();
  if (!scriptPaths.contains(uri)) {
    super.doGet(request,response);
    return;
  }
  Resource scriptFile=getResource(uri);
  InputStream is=scriptFile.getInputStream();
  StringBuffer script=new StringBuffer();
  byte[] buffer=new byte[1024];
  while (is.available() > 0) {
    int numRead=is.read(buffer);
    if (numRead <= 0) {
      break;
    }
    script.append(new String(buffer,0,numRead,"UTF-8"));
  }
  String startReplaceString="/* @preserve AppScriptServlet - getPort */";
  String endReplaceString="/* @preserve AppScriptServlet - close */";
  int startIndex=script.indexOf(startReplaceString);
  int endIndex=script.indexOf(endReplaceString,startIndex);
  if (startIndex >= 0 && endIndex >= 0) {
    String replaceString="this.getPort=function(){return " + websocketPort + "};";
    script.replace(startIndex,endIndex + endReplaceString.length(),replaceString);
  }
  response.getWriter().println(script.toString());
}
