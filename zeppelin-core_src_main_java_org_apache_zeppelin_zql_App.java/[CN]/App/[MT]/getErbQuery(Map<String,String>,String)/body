{
  String varName="zeppelinAppScriptOut_" + System.currentTimeMillis() + "_"+ random.nextInt(100);
  ScriptEngine engine=getRubyScriptEngine();
  StringBuffer rubyScript=new StringBuffer();
  rubyScript.append("require 'erb'\n");
  rubyScript.append("$" + varName + " = ERB.new(File.read('"+ templatePath+ "')).result(binding)\n");
  SimpleBindings bindings=new SimpleBindings();
  engine.setBindings(bindings,ScriptContext.ENGINE_SCOPE);
  bindings.put("hql",sql);
  bindings.putAll(params);
  try {
    engine.eval(rubyScript.toString(),bindings);
  }
 catch (  ScriptException e) {
    e.printStackTrace();
    logger.log(Level.SEVERE,"ERB error",e);
    return null;
  }
  return (String)engine.getBindings(ScriptContext.ENGINE_SCOPE).get(varName);
}
