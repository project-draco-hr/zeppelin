{
  TreeMap<String,ZQLJob> found=new TreeMap<String,ZQLJob>();
  Path dir=new Path(jobPersistBasePath);
  try {
    if (!fs.getFileStatus(dir).isDir()) {
      return found;
    }
  }
 catch (  IOException e) {
    logger.error("Can't scan dir " + dir,e);
    return found;
  }
  FileStatus[] files=null;
  List<FileStatus> jobDirs=new LinkedList<FileStatus>();
  try {
    files=fs.listStatus(dir);
    if (files == null) {
      return found;
    }
    for (    FileStatus f : files) {
      if (f.getPath().getName().startsWith(".")) {
        continue;
      }
      jobDirs.add(f);
    }
  }
 catch (  IOException e) {
    logger.error("Can't list dir " + dir,e);
  }
  files=jobDirs.toArray(new FileStatus[]{});
  Arrays.sort(files,new Comparator<FileStatus>(){
    @Override public int compare(    FileStatus a,    FileStatus b){
      String aName=a.getPath().getName();
      String bName=b.getPath().getName();
      return bName.compareTo(aName);
    }
  }
);
  for (  FileStatus f : files) {
    ZQLJob job;
    try {
      Path path=f.getPath();
      String jobId=getJobIdFromPath(path);
      job=load(jobId,new Path(path.toString() + CURRENT_JOB_FILE_NAME),false);
      if (job != null) {
        found.put(job.getId(),job);
      }
 else {
        logger.error("Job not loaded " + f.getPath());
      }
    }
 catch (    IOException e) {
      logger.error("Can't load job from path " + f.getPath(),e);
    }
  }
  return found;
}
