{
  final Map<String,ZeppelinDriver> drivers=zengine.createAvailableDrivers();
  String currentDriverName=zengine.getDriverFactory().getDefaultConfigurationName();
  ZeppelinDriver currentDriver=drivers.get(currentDriverName);
  List<Z> zList=new LinkedList<Z>();
  Z currentZ=null;
  String escapeSeq="\"',;<%>!";
  char escapeChar='\\';
  String[] blockStart=new String[]{"\"","'","<%","N_<","!"};
  String[] blockEnd=new String[]{"\"","'","%>","N_>",";"};
  String[] t=Util.split(stmts,escapeSeq,escapeChar,blockStart,blockEnd,op,true);
  String currentOp=null;
  for (int i=0; i < t.length; i++) {
    String stmt=t[i];
    if (stmt == null)     continue;
    stmt=stmt.trim();
    if (stmt.length() == 0)     continue;
    boolean operatorFound=false;
    for (    String o : op) {
      if (o.equals(stmt)) {
        if (currentOp != null) {
          throw new ZQLException("Operator " + o + " can not come after "+ currentOp);
        }
        currentOp=o;
        operatorFound=true;
        break;
      }
    }
    if (operatorFound == true) {
      continue;
    }
    if (currentZ == null && currentOp != null) {
      throw new ZQLException(currentOp + " can not be at the beginning");
    }
    if (op[2].equals(currentOp)) {
      throw new ZQLException("redirection (append) not implemented");
    }
 else     if (op[3].equals(currentOp)) {
      if (currentZ != null) {
        RedirectStatement red=new RedirectStatement(stmt);
        currentZ.withName(red.getName());
        currentZ.withTable(red.isTable());
        currentOp=null;
        continue;
      }
 else {
        throw new ZQLException("Can not redirect empty");
      }
    }
    if (stmt.startsWith("@")) {
      if (currentZ != null) {
        if (currentOp == null || (currentOp != null && currentOp.equals(op[0]))) {
          currentZ.setDriver(currentDriver);
          zList.add(currentZ);
          currentZ=null;
          currentOp=null;
        }
 else {
          throw new ZQLException("Can not piped or redirected from/to exec statement");
        }
      }
      try {
        AnnotationStatement annotation=new AnnotationStatement(stmt,zengine,currentDriver);
        if (ANNOTATION.DRIVER == annotation.getAnnotation()) {
          if (COMMAND.SET == annotation.getCommand()) {
            String driverName=annotation.getArgument();
            if (driverName == null) {
              driverName=zengine.getDriverFactory().getDefaultConfigurationName();
            }
            currentDriver=drivers.get(driverName);
            if (currentDriver == null) {
              throw new ZQLException("Can not find driver " + driverName);
            }
          }
        }
        currentZ=annotation;
      }
 catch (      ZException e) {
        throw new ZQLException(e);
      }
      continue;
    }
    Z z=null;
    try {
      z=loadL(stmt,currentDriver);
    }
 catch (    ZException e) {
    }
    if (z == null) {
      Q q;
      try {
        q=new Q(stmt,zengine,currentDriver);
      }
 catch (      ZException e) {
        throw new ZQLException(e);
      }
      z=q;
    }
    if (currentZ == null) {
      currentZ=z;
    }
 else     if (currentOp == null) {
      throw new ZQLException("Assert! Statment does not have operator in between");
    }
 else     if (currentOp.equals(op[0])) {
      currentZ.setDriver(currentDriver);
      zList.add(currentZ);
      currentZ=z;
      currentOp=null;
    }
 else     if (currentOp.equals(op[1])) {
      currentZ=currentZ.pipe(z);
      currentOp=null;
    }
  }
  if (currentZ != null) {
    currentZ.setDriver(currentDriver);
    zList.add(currentZ);
  }
  return zList;
}
