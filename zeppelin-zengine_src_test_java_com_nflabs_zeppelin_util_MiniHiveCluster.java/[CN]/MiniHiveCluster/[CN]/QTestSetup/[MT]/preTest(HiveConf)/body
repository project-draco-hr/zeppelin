{
  if (zooKeeperCluster == null) {
    String tmpdir=System.getProperty("user.dir") + "/../build/ql/tmp";
    zooKeeperCluster=new MiniZooKeeperCluster();
    zkPort=zooKeeperCluster.startup(new File(tmpdir,"zookeeper"));
  }
  if (zooKeeper != null) {
    zooKeeper.close();
  }
  int sessionTimeout=conf.getIntVar(HiveConf.ConfVars.HIVE_ZOOKEEPER_SESSION_TIMEOUT);
  zooKeeper=new ZooKeeper("localhost:" + zkPort,sessionTimeout,null);
  String zkServer="localhost";
  conf.set("hive.zookeeper.quorum",zkServer);
  conf.set("hive.zookeeper.client.port","" + zkPort);
}
